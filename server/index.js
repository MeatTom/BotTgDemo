const TelegramBot = require('node-telegram-bot-api');
require('dotenv').config();
const token = process.env.BOT_TOKEN;
const bot = new TelegramBot(token, { polling: true, interval: 300, onlyFirstMatch: true });
const webAppUrl ='https://github.com/MeatTom';

const commands = [
    { command: 'start', description: '–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º' },
    { command: 'catalog', description: '–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–∞–ª–æ–≥'},
    { command: 'about', description: '–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏' },
    { command: 'contacts', description: '–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏' },
    { command: 'help', description: '–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º' },
];

bot.setMyCommands(commands);

const keyboardMarkup = {
    reply_markup: {
        keyboard: [
            [{ text: '–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–∞–ª–æ–≥', web_app: {url: webAppUrl} }],
            [{ text: '–û –∫–æ–º–ø–∞–Ω–∏–∏' }],
            [{ text: '–ö–æ–Ω—Ç–∞–∫—Ç—ã' }],
            [{ text: '–ü–æ–º–æ—â—å' }],
        ],

        resize_keyboard: true,
        one_time_keyboard: false,
    },
};

const sendCatalogButton = {
    text: '–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–∞–ª–æ–≥',
    web_app: {url: webAppUrl}
};

const sendAboutMessage = (chatId) => {
    bot.sendMessage(
        chatId,
        '<pre>–ù–∞—à–∞ –∫–æ–º–ø–∞–Ω–∏—è</pre>\n' +
        '\n' +
        '<b>MERA</b> ‚Äì —ç—Ç–æ –¥–∏–Ω–∞–º–∏—á–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—é—â–∏–π—Å—è –±—Ä–µ–Ω–¥, –∑–∞–Ω–∏–º–∞—é—â–∏–π—Å—è –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ–º –∏ –ø–æ—Å—Ç–∞–≤–∫–∞–º–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ-–∏–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–±–æ—Ä–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏ –¥–ª—è –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π.\n' +
        '\n' +
        '–¢–æ—Ä–≥–æ–≤–∞—è –º–∞—Ä–∫–∞ MERA –ø–æ—è–≤–∏–ª–∞—Å—å –Ω–∞ –æ—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —Ä—ã–Ω–∫–µ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –∞–∫—Ç–∏–≤–Ω—ã–µ –∏ –∞–º–±–∏—Ü–∏–æ–∑–Ω—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –æ—Ç—Ä–∞—Å–ª–∏ –æ—Å–æ–∑–Ω–∞–ª–∏, —á—Ç–æ —Ä–æ—Å—Å–∏–π—Å–∫–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ–π —Ü–µ–Ω–µ. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è.\n' +
        '\n' +
        '–¢–∞–∫ <b>MERA</b> –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∞ —Å–≤–æ—é <b>–º–∏—Å—Å–∏—é</b> - –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ä–æ—Å—Å–∏–π—Å–∫–∏–º –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è–º –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º <b>–≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –ø–æ —Ä–∞–∑—É–º–Ω–æ–π —Ü–µ–Ω–µ.</b>',
        { parse_mode: 'HTML' }
    );
};

const sendContactsMessage = (chatId) => {
    bot.sendMessage(
        chatId,
        '<pre>–ù–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã</pre>\n' +
        '\n' +
        'üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7(812)677-05-77 \n' +
        '\n' +
        '‚úâ –ü–æ—á—Ç–∞: info@mera-russia.com \n' +
        '\n' +
        'üïì –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: \n' +
        '–ü–Ω-–ü—Ç: 9.00 - 18.00\n' +
        '–°–±-–í—Å: –í—ã—Ö–æ–¥–Ω–æ–π\n' +
        '\n' +
        'üìç–ê–¥—Ä–µ—Å: 199106, –°–∞–Ω–∫—Ç- –ü–µ—Ç–µ—Ä–±—É—Ä–≥, —É–ª. –ë–æ–ª—å—à–∞—è –ú–æ—Ä—Å–∫–∞—è, 37',
        { parse_mode: 'HTML' }
    ).then(() => {
        bot.sendLocation(
            chatId,
            59.934871, 30.253076
        );
    });
};

const sendHelpMessage = (chatId) => {
    bot.sendMessage(
        chatId,
        '–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –æ–ø—Ü–∏–π –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –æ–¥–Ω—É –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–æ–º–∞–Ω–¥ –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ—ë:\n' +
        '\n' +
        '/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º\n' +
        '/catalog - –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤\n' +
        '/about - –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏\n' +
        '/contacts - –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏\n' +
        '/help - –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º\n'+
        '\n' +
        '–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º: @furno_kalipso',
        { parse_mode: 'HTML' }
    );
};

bot.onText(/\/start/, (msg) => {
    bot.sendMessage(msg.chat.id, '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í–∞—Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –±–æ—Ç –∫–æ–º–ø–∞–Ω–∏–∏ "MERA" –ø–æ –∑–∞–∫–∞–∑—É –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ-–∏–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–±–æ—Ä–æ–≤. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –æ–ø—Ü–∏–π –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –æ–¥–Ω—É –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–æ–º–∞–Ω–¥ (–∏—Ö —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –≤ –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é —Å –∫–æ–º–∞–Ω–¥–∞–º–∏):\n'+
        '/start\n' +
        '/catalog\n' +
        '/about\n' +
        '/contacts\n' +
        '/help',
        keyboardMarkup);
});

bot.onText(/\/about/, (msg) => {
    sendAboutMessage(msg.chat.id);
});

bot.onText(/\/contacts/, (msg) => {
    sendContactsMessage(msg.chat.id);
});

bot.onText(/\/help/, (msg) => {
    sendHelpMessage(msg.chat.id);
});

bot.onText(/\/catalog/, (msg) => {
    bot.sendMessage(msg.chat.id, '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–∞–ª–æ–≥', {
        reply_markup: {
            inline_keyboard: [[sendCatalogButton]]
        }
    });
});

bot.on('message', (msg) => {
    const message = msg.text.toLowerCase();
    switch (message) {
        case '–æ –∫–æ–º–ø–∞–Ω–∏–∏':
            sendAboutMessage(msg.chat.id);
            break;
        case '–∫–æ–Ω—Ç–∞–∫—Ç—ã':
            sendContactsMessage(msg.chat.id);
            break;
        case '–ø–æ–º–æ—â—å':
            sendHelpMessage(msg.chat.id);
            break;
    }
});